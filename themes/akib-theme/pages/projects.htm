url = "/projects/page/:page?"
layout = "default"
title = "Layihələr"

[collection projects]
handle = "projects"
pageNumber = "{{ :page }}"
sortColumn = "created_at"
sortDirection = "desc"
==
{% set page = this.param.page %}
{% if not page or page matches '/\D/' %}
    {% set page = 1 %}
{% endif %}
{% set perPage = 12 %}

{% set totalCount = projects.get().count() %}
{% set lastPage = (totalCount / perPage)|round(0, 'ceil') %}

{% if page > lastPage and lastPage > 0 %}
    {% do redirect('projects') %}
{% endif %}

{% set allProjects = projects.get()|sort((a, b) => b.created_at <=> a.created_at) %}
{% set records = allProjects|slice((page - 1) * perPage, perPage) %}
{% set imgUrls = {
    banner: 'storage/app/media/2440x1578.png' | app,
} %}

<!-- OG Meta Tags -->
<meta property="og:title" content="Layihələr - Akib" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ this.url }}" />
<meta property="og:image" content="{{ projects|first.image|media }}" />

<!-- Start Page Title -->
<div
    class="page-title-area shadow dark bg-fixed text-center text-light"
    style="background-image: url('{{ imgUrls.banner }}');"
>
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12">
                <h1>{{ 'Layihələr'|_ }}</h1>
            </div>
        </div>
    </div>
</div>
<!-- End Page Title -->

<!-- Start Our Services -->
<div class="blog-area services-area icon-only default-padding bottom-less">
    <div class="container">
        <div class="services-items">
            <div class="row g-4">
                {% if records|length %} {% for project in records %}
                <div class="col-md-4 col-sm-6 d-flex">
                    <div class="item shadow-sm p-5 bg-white rounded flex-fill">
                        <div class="info">
                            {% if project.image %}
                            <a href="{{ 'projects-detail'|page({ slug: project.slug }) }}">
                                <img
                                    src="{{ project.image|media }}"
                                    alt="{{ project.title }}"
                                    style="width: 60px; margin-bottom: 50px"
                                />
                            </a>
                            {% endif %}
                            <a href="{{ 'projects-detail'|page({ slug: project.slug }) }}">
                                <h4>
                                    {% if project.title|length > 20 %}
                                        {{ project.title|slice(0, 20) ~ '...' }}
                                    {% else %}
                                        {{ project.title }}
                                    {% endif %}
                                </h4>
                            </a>
                            <a href="{{ 'projects-detail'|page({ slug: project.slug }) }}">
                                <p>
                                    {% if project.excerpt %}
                                        {{ project.excerpt }}
                                    {% else %}
                                        {{ project.content|striptags|slice(0, 100) }}...
                                    {% endif %}
                                </p>
                            </a>
                            <a class="btn btn-theme border btn-sm" href="{{ 'projects-detail'|page({ slug: project.slug }) }}">
                                  {{ 'Ətraflı'|_ }}
                                  <i class="fas fa-angle-double-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %} {% else %}
                <div class="col-md-12">
                    <div class="alert alert-info">
                        {{ 'Heç bir layihə tapılmadı.'|_ }}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        {% if lastPage > 1 %}
        <div class="row">
            <div class="col-md-12 pagi-area text-center">
                <nav aria-label="navigation">
                    <ul class="pagination">
                        {% if page > 1 %}
                        <li class="page-item">
                            <a
                                class="page-link"
                                href="{{ 'projects'|page({ page: page - 1 }) }}"
                            >
                                «
                            </a>
                        </li>
                        {% endif %} {% for i in 1..lastPage %}
                        <li class="page-item {{ page == i ? 'active' : '' }}">
                            <a
                                class="page-link"
                                href="{{ 'projects'|page({ page: i }) }}"
                            >
                                {{ i }}
                            </a>
                        </li>
                        {% endfor %} {% if page < lastPage %}
                        <li class="page-item">
                            <a
                                class="page-link"
                                href="{{ 'projects'|page({ page: page + 1 }) }}"
                            >
                                »
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>
        {% endif %}
    </div>
</div>
<!-- End Our Services -->